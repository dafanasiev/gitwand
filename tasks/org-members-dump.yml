---
- name: "Dump admins of the {{ github_org }} organization"
  include_tasks: org-members-dump-role.yml
  vars:
    role: admin

- name: "There're {{ mmbrs | length }} admins in the {{ github_org }} organization"
  set_fact:
    org_admin: "{{ mmbrs }}"

- name: "Dump ordinary members of the {{ github_org }} organization"
  include_tasks: org-members-dump-role.yml
  vars:
    role: member

- name: "There're {{ mmbrs | length }} ordinary members in the {{ github_org }} organization"
  set_fact:
    org_member: "{{ mmbrs }}"

- name: "Dump all members of the {{ github_org }} organization"
  copy:
    content: |
      {{ github_org }}:
        name: {{ orgs[github_org].name }}
      {% if org_admin | length > 0 %}
        admin:
      {{ org_admin | sort | to_nice_yaml | indent(4, true) }}
      {%- endif %}
      {% if org_member | length > 0 %}
        member:
      {{ org_member | sort | to_nice_yaml | indent(4, true) }}
      {%- endif %}
        absent: []
    dest: "{{ github_vars_dir }}/orgs/{{ github_org }}.yml"
